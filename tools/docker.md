# Docker

## Docker Image and Docker Container

A `Docker image` is a read-only template that contains the source code, libraries, dependencies, tools, and other files for creating `a container` that can run on the `Docker platform`.

Since images are, in a way, just templates, you cannot start or run them. What you can do is use that template as a base to build a container. A container is, ultimately, just a running image.

The command for creating an image from a Dockerfile is __docker build__.

<img src="fig/container-layers.png">

A `Docker container` is a virtualized run-time environment where users can isolate applications from the underlying system. 

To create a container layer from an image, use the command __docker create__.

<img src="fig/container-vs-virtual-machine.png">

### Show the docker images
```
docker images
```

### Show the running docker containers
```
docker ps
```

## How to Create a Docker Image

### Interactive Method

__Advantages__: Quickest and simplest way to create Docker images. 

__Disadvantages__: Requiring error-prone manual reconfiguration of live interactive processes. 

The following is a set of simplified steps to creating an image interactively:

- Install Docker and launch the Docker engine.
- Open a terminal session.
- Use the following __Docker run__ command to start an interactive shell session with a container launched from the image specified by __image_name:tag_name__:
    ``` 
    docker run -it image_name:tag_name bash
    ```

    If you omit the tag name, then Docker automatically pulls the most recent image version, which is identified by the latest tag. If Docker cannot find the image locally then it will pull what it needs to build the container from the appropriate repository on Docker Hub.

    In our example, we’ll launch a container environment based on the latest version of Ubuntu:

    ```
    docker run -it ubuntu bash
    ```

- Now configure your container environment by, for example, installing all the frameworks, dependencies, libraries, updates, and application code you need. The following simple example adds an NGINX server:
    ```
    apt-get update && apt-get install -y nginx
    ```

    Next, you’ll need to know the name or ID of your running container instance.

- Open another Bash shell and type the following docker ps command to list active container processes:
    ```
    docker ps    
    ```

    ```
    CONTAINER ID   IMAGE     COMMAND   CREATED         STATUS         PORTS     NAMES
    b20edbad48a6   ubuntu    "bash"    3 minutes ago   Up 3 minutes             vigorous_almeida
    ```
    This container name is randomly generated by the Docker daemon. But you can also identify your container with something more meaningful by assigning your own name using the __– name operator__ in the __Docker run__ command.

- Save your image using the __Docker commit__ command, specifying either the ID or name of the container from you which want to create it:
    ```
    docker commit vigorous_almeida ubuntu_testbed
    ```

    In the example above, we supplied the name of our container and called the resulting image __ubuntu_testbed__.

- Now, use the __Docker images__ command to see the image you’ve just created:
    ```
    docker images
    ```

- Finally, return to your interactive container shell and type exit to shut it down.
    ```
    exit
    ```

### Dockerfile Method

__Advantages__: Clean, compact and repeatable recipe-based images. Easier lifecycle management and easier integration into continuous integration (CI) and continuous delivery (CD) processes. 

The Dockerfile approach is the method of choice for real-world, enterprise-grade container deployments. It’s a more systematic, flexible, and efficient way to build Docker images and the key to compact, reliable, and secure container environments.

In short, the Dockerfile method is a three-step process whereby you create the Dockerfile and add the commands you need to assemble the image.

[Example Dockerfile](./Dockerfile)
```
# Use the official Ubuntu 18.04 as base
FROM ubuntu:18.04
# Install nginx and curl
RUN apt-get update && apt-get upgrade -y && apt-get install -y nginx curl && rm -rf /var/lib/apt/lists/*
```

Now use the Docker build command to create your Docker image. Use the -t flag to set an image name and tag:
```
docker build -f Dockerfile -t my-nginx:0.1 .
```
